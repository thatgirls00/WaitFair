spring:
  config:
    import: optional:file:.env.properties
  profiles:
    active: dev
    include: secret
  jackson:
    time-zone: Asia/Seoul
  output:
    ansi:
      enabled: always
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        default_batch_fetch_size: 100
        jdbc:
          time_zone: Asia/Seoul
    hibernate:
      ddl-auto: update
    show-sql: true
  mvc:
    hiddenmethod:
      filter:
        enabled: true
  data:
    redis:
      host: localhost
      port: 6379
      password: ${REDIS_PASSWORD:}
      timeout: 200ms
      connect-timeout: 200ms
  flyway:
    enabled: true
    baseline-on-migrate: true
    baseline-version: 1
    baseline-description: "baseline existing schema"
    locations: classpath:db/migration

server:
  tomcat:
    basedir: .
    accesslog:
      enabled: true
      directory: logs
      prefix: access
      suffix: .log
      file-date-format: .yyyy-MM-dd
      max-days: 14
      pattern: '%h %t "%r" %s %b %D %{X-Request-Id}o "%{User-Agent}i"'
logging:
  level:
    root: INFO
    com.back: DEBUG
    org.hibernate.orm.jdbc.bind: OFF
    org.hibernate.orm.jdbc.extract: OFF
    org.springframework.transaction.interceptor: INFO


springdoc:
  swagger-ui:
    tags-sorter: alpha
    operations-sorter: method
  default-produces-media-type: application/json
  default-consumes-media-type: application/json

custom:
  cors:
    allowed-origins:
      - https://www.waitfair.shop
      - http://localhost:3000
      - http://localhost:5173
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
      - OPTIONS
    allowed-headers:
      - "Authorization"
      - "Content-Type"
      - "Accept"
      - "Origin"
      - "X-Requested-With"
      - "Cache-Control"
      - "Pragma"
      - "X-Recaptcha-Token"

  jwt:
    secret: ${JWT_SECRET}
    access-token-duration: ${JWT_ACCESS_TOKEN_DURATION:3600}
    refresh-token-duration: ${JWT_REFRESH_TOKEN_DURATION:1209600}

  dev:
    domain: localhost
    back-url: "http://${custom.dev.domain}:8080"
    front-url: "http://${custom.dev.domain}:3000"
  prod:
    domain: ${API_BASE_URL}
    back-url: "https://api.${custom.prod.domain}"
    front-url: "https://www.${custom.prod.domain}"
  site:
    domain: "${custom.dev.domain}"
    back-url: "${custom.dev.back-url}"
    front-url: "${custom.dev.front-url}"

queue:
  scheduler:
    #입장 처리 스케줄러
    entry:
      cron: "*/10 * * * * *" # 10초마다 실행
      batch-size: 5 # 한 번에 입장시킬 인원 100
      max-entered-limit: 100  # 최대 수용 인원

    #셔플 처리 스케줄러
    shuffle:
      cron: "*/30 * * * * *" # 테스트를 위해 30초마다 실행
      #cron: "0 */10 * * * *" # 10분마다 실행
      time-range-minutes: 1 # 시간 범위

    expire:
      cron: "0 * * * * *"

event:
  scheduler:
    open:
      cron: "0 * * * * *"

# Actuator/micrometer/prometheus 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: waitfair-backend
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.95,0.99
security:
  password:
    bcrypt-strength: 8 # prod 8 이상, perf/test/dev 4

# coolSMS
coolsms:
  api-Key: ${SMS_API_KEY}
  api-Secret: ${SMS_SECRET_KEY}
  sender-Number: ${SMS_SENDER_NUMBER}

# S3
cloud:
  aws:
    region: ap-northeast-2
    s3:
      bucket: ${S3_BUCKET_NAME}
    presigned:
      put-expire-minutes: 5
      get-expire-minutes: 10

# reCAPTCHA
google:
  captcha:
    secret-key: ${RECAPTCHA_SECRET_KEY}

# TossPayments
toss:
  payments:
    secret: ${TOSS_SECRET_KEY}

resilience4j:
  circuitbreaker:
    instances:
      redisAuth:
        slidingWindowType: COUNT_BASED
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        permittedNumberOfCallsInHalfOpenState: 2
        recordExceptions:
          - java.io.IOException
          - org.springframework.data.redis.RedisConnectionFailureException
          - io.lettuce.core.RedisConnectionException
          - io.lettuce.core.RedisCommandTimeoutException
